<?php
namespace riotDecode\inibin\mapper;

class Spell {
    protected $mapping;

    protected static $inibinStructure = [
        'GeneralDataHero' => [
            'DefaultChampionCollisionRadius',
            'GameplayCollisionRadius'
        ],
        'Info' => [
            'IconCircle',
            'IconSquare'
        ],
        'MeshSkin' => [
            'Texture',
            'SkinScale',
            'Skeleton',
            'SimpleSkin',
            'EmissiveTexture',
            'SelfIllumination'
        ],
        'SpellData' => [
            'Version',
            'AlternateName',
            'DisplayName',
            'Description',
            'DynamicTooltip',
            'DynamicExtended',
            'Effect1Level0Amount',
            'Effect1Level1Amount',
            'Effect1Level2Amount',
            'Effect1Level3Amount',
            'Effect1Level4Amount',
            'Effect1Level5Amount',
            'Effect1Level6Amount',
            'Effect2Level0Amount',
            'Effect2Level1Amount',
            'Effect2Level2Amount',
            'Effect2Level3Amount',
            'Effect2Level4Amount',
            'Effect2Level5Amount',
            'Effect2Level6Amount',
            'Effect3Level0Amount',
            'Effect3Level1Amount',
            'Effect3Level2Amount',
            'Effect3Level3Amount',
            'Effect3Level4Amount',
            'Effect3Level5Amount',
            'Effect3Level6Amount',
            'Effect4Level0Amount',
            'Effect4Level1Amount',
            'Effect4Level2Amount',
            'Effect4Level3Amount',
            'Effect4Level4Amount',
            'Effect4Level5Amount',
            'Effect4Level6Amount',
            'Effect5Level0Amount',
            'Effect5Level1Amount',
            'Effect5Level2Amount',
            'Effect5Level3Amount',
            'Effect5Level4Amount',
            'Effect5Level5Amount',
            'Effect5Level6Amount',
            'Coefficient',
            'Coefficient2',
            'AnimationName',
            'AnimationLoopName',
            'AnimationWinddownName',
            'AnimationLeadOutName',
            'InventoryIcon',
            'InventoryIcon1',
            'InventoryIcon2',
            'MinimapIcon',
            'KeywordWhenAcquired',
            'MinimapIconRotation',
            'MinimapIconDisplayFlag',
            'Cooldown',
            'ChannelDuration',
            'ManaCost1',
            'ManaCost2',
            'ManaCost3',
            'ManaCost4',
            'ManaCost5',
            'ManaCost6',
            'Cooldown1',
            'Cooldown2',
            'Cooldown3',
            'Cooldown4',
            'Cooldown5',
            'Cooldown6',
            'ChannelDuration1',
            'ChannelDuration2',
            'ChannelDuration3',
            'ChannelDuration4',
            'ChannelDuration5',
            'ChannelDuration6',
            'FloatVarsDecimals1',
            'FloatVarsDecimals2',
            'FloatVarsDecimals3',
            'FloatVarsDecimals4',
            'FloatVarsDecimals5',
            'FloatVarsDecimals6',
            'FloatStaticsDecimals1',
            'FloatStaticsDecimals2',
            'FloatStaticsDecimals3',
            'FloatStaticsDecimals4',
            'FloatStaticsDecimals5',
            'FloatStaticsDecimals6',
            'Level1Desc',
            'Level2Desc',
            'Level3Desc',
            'Level4Desc',
            'Level5Desc',
            'Level6Desc',
            'CastRadiusTexture',
            'CastRadiusSecondaryTexture',
            'LineTargetingBaseTextureOverrideName',
            'LineTargetingTargetTextureOverrideName',
            'CastRangeTextureOverrideName',
            'MaxGrowthRangeTextureName',
            'MaxGrowthLineBaseTextureName',
            'MaxGrowthLineTargetTextureName',
            'TargettingType',
            'CastRange',
            'CastRange1',
            'CastRange2',
            'CastRange3',
            'CastRange4',
            'CastRange5',
            'CastRange6',
            'CastRangeUseBoundingBoxes',
            'CastRangeDisplayOverride',
            'CastRadius',
            'CastRadiusSecondary',
            'CastConeDistance',
            'CastConeAngle',
            'Flags',
            'CastType',
            'CastFrame',
            'MissileSpeed',
            'MissileAccel',
            'MissileMaxSpeed',
            'MissileMinSpeed',
            'MissileFixedTravelTime',
            'MissileLifetime',
            'MissileEffect',
            'MissileEffectPlayer',
            'MissileBoneName',
            'MissilePerceptionBubbleRadius',
            'MissilePerceptionBubbleRevealsStealth',
            'CircleMissileRadialVelocity',
            'CircleMissileAngularVelocity',
            'HaveHitEffect',
            'HaveHitBone',
            'HaveAfterEffect',
            'HavePointEffect',
            'IsToggleSpell',
            'TriggersGlobalCooldown',
            'SubjectToGlobalCooldown',
            'HitEffectName',
            'HitEffectPlayerName',
            'HitBoneName',
            'HitEffectOrientType',
            'AfterEffectName',
            'PointEffectName',
            'OverrideCastTime',
            'DelayCastOffsetPercent',
            'DelayTotalTimePercent',
            'CastTargetAdditionalUnitsRadius',
            'LineWidth',
            'LineDragLength',
            'LineMissileBounces',
            'LineMissileUsesAccelerationForBounce',
            'LineMissileFollowsTerrainHeight',
            'StartCooldown',
            'MissileGravity',
            'LineMissileCollisionFromStartPoint',
            'LineMissileDelayDestroyAtEndSeconds',
            'LineMissileTimePulseBetweenCollisionSpellHits',
            'LuaOnMissileUpdateDistanceInterval',
            'MissileTargetHeightAugment',
            'LineMissileTargetHeightAugment',
            'BounceRadius',
            'DeathRecapPriority',
            'LineMissileEndsAtTargetPoint',
            'UseMinimapTargeting',
            'CantCancelWhileWindingUp',
            'CantCancelWhileChanneling',
            'ApplyAttackDamage',
            'ApplyAttackEffect',
            'ApplyMaterialOnHitSound',
            'DoesntBreakChannels',
            'BelongsToAvatar',
            'IsDisabledWhileDead',
            'CanCastWhileDisabled',
            'CanOnlyCastWhileDisabled',
            'CanOnlyCastWhileDead',
            'CursorChangesInGrass',
            'CantCastWhileRooted',
            'CannotBeSuppressed',
            'LockConeToPlayer',
            'AlwaysSnapFacing',
            'UseAnimatorFramerate',
            'UseChargeChanneling',
            'UseChargeTargeting',
            'CanMoveWhileChanneling',
            'DisableCastBar',
            'DoNotNeedToFaceTarget',
            'LineMissileTrackUnits',
            'NoWinddownIfCancelled',
            'UseAutoattackCastTime',
            'IgnoreAnimContinueUntilCastFrame',
            'LocationTargettingWidth1',
            'LocationTargettingWidth2',
            'LocationTargettingWidth3',
            'LocationTargettingWidth4',
            'LocationTargettingWidth5',
            'LocationTargettingWidth6',
            'LocationTargettingLength1',
            'LocationTargettingLength2',
            'LocationTargettingLength3',
            'LocationTargettingLength4',
            'LocationTargettingLength5',
            'LocationTargettingLength6',
            'ParticleStartOffset',
            'SpellRevealsChampion',
            'DrawSecondaryLineIndicator',
            'OrientRangeIndicatorToCursor',
            'OrientRangeIndicatorToFacing',
            'IgnoreRangeCheck',
            'OrientRadiusTextureFromPlayer',
            'CastRangeGrowthMax',
            'CastRangeGrowthDuration',
            'TargeterConstrainedToRange',
            'SelectionPreference',
            'TextFlags',
            'RangeIndicatorTextureName',
            'Sound_CastName',
            'Sound_HitName'
        ],
        'Hacks' => [
            'DisableMeshMemoryOptimization'
        ],
        'ItemInclusionList' => [
            'itemName'
        ],
        'UnpurchasableItemList' => [
            'itemName'
        ],
        'Useable' => [
            'IsUseable',
            'GoldRedirectTargetUseableOnly',
            'AllyCanUse',
            'EnemyCanUse',
            'HeroUseSpell',
            'MinionUseSpell',
            'CooldownSpellSlot',
            'MinionUseable'
        ],
        'BuffData' => [
            'DynamicTooltip',
            'DeathRecapPriority',
            'FloatVarsDecimals1',
            'FloatVarsDecimals2',
            'FloatVarsDecimals3'
        ],
        'Data' => [
            'name',
            'Description',
            'Name',
            'Armor',
            'ExtraAttack1',
            'CritAttack',
            'IsMelee',
            'BaseHP',
            'BaseMP',
            'HPPerLevel',
            'MPPerLevel',
            'HPRegenPerLevel',
            'MPRegenPerLevel',
            'BaseStaticHPRegen',
            'BaseFactorHPRegen',
            'BaseStaticMPRegen',
            'BaseFactorMPRegen',
            'BaseDamage',
            'DamagePerLevel',
            'ArmorPerLevel',
            'SpellBlock',
            'SpellBlockPerLevel',
            'BaseDodge',
            'LevelDodge',
            'BaseCritChance',
            'CritPerLevel',
            'CritDamageBonus',
            'MoveSpeed',
            'AttackRange',
            'AcquisitionRange',
            'AttackDelayCastOffsetPercent',
            'AttackDelayOffsetPercent',
            'AttackSpeedPerLevel',
            'Spell1',
            'Spell2',
            'Spell3',
            'Spell4',
            'ExtraSpell1',
            'Lore1',
            'Tips1',
            'Tips2',
            'ArmorMaterial',
            'WeaponMaterial',
            'SelectionHeight',
            'SelectionRadius',
            'PathfindingCollisionRadius',
            'DefaultChampionCollisionRadius',
            'PathfindingCollisionRadius',
            'DisplayName',
            'MaxStack',
            'Price',
            'ItemCalloutPlayer',
            'ItemCalloutSpectator',
            'CanBeSold',
            'CanBeDropped',
            'DropsOnDeath',
            'DisappersOnDeath',
            'UseWhenAcquired',
            'ItemClass',
            'ItemType',
            'InStore',
            'IsRecipe',
            'Consumed',
            'UsableInStore',
            'Clickable',
            'RecipeItem1',
            'RecipeItem2',
            'RecipeItem3',
            'RecipeItem4',
            'RecipeItem5',
            'RecipeItem6',
            'RecipeItem7',
            'RecipeItem8',
            'RequiredItem1',
            'RequiredItem2',
            'RequiredItem3',
            'RequiredItem4',
            'RequiredItem5',
            'RequiredItem6',
            'RequiredItem7',
            'RequiredItem8',
            'RequiredChampion',
            'SpellName',
            'SpellLevel',
            'SpellCharges',
            'FlatCooldownMod',
            'PercentCooldownMod',
            'FlatHPPoolMod',
            'PercentHPPoolMod',
            'FlatHPRegenMod',
            'PercentHPRegenMod',
            'PercentTenacityCharacterMod',
            'PercentTenacityItemMod',
            'PercentTenacityMasteryMod',
            'PercentTenacityRuneMod',
            'PercentTenacityCleanseMod',
            'PercentSlowResistMod',
            'FlatMovementSpeedMod',
            'PercentMovementSpeedMod',
            'PercentMultiplicativeMovementSpeedMod',
            'FlatArmorMod',
            'PercentArmorMod',
            'FlatArmorPenetrationMod',
            'PercentArmorPenetrationMod',
            'FlatSpellBlockMod',
            'PercentSpellBlockMod',
            'FlatMagicPenetrationMod',
            'PercentMagicPenetrationMod',
            'FlatDodgeMod',
            'FlatMissChanceMod',
            'FlatCritChanceMod',
            'FlatCritDamageMod',
            'PercentCritDamageMod',
            'FlatPhysicalDamageMod',
            'PercentPhysicalDamageMod',
            'FlatMagicDamageMod',
            'PercentMagicDamageMod',
            'FlatPhysicalReduction',
            'PercentPhysicalReduction',
            'FlatMagicReduction',
            'PercentMagicReduction',
            'PercentEXPBonus',
            'FlatAttackRangeMod',
            'PercentAttackRangeMod',
            'FlatCastRangeMod',
            'PercentCastRangeMod',
            'PercentAttackSpeedMod',
            'PercentMultiplicativeAttackSpeedMod',
            'PercentLifeStealMod',
            'PercentSpellVampMod',
            'PercentSpellEffectivenessMod',
            'PercentHealingAmountMod',
            'FlatBubbleRadius',
            'PercentBubbleRadius',
            'SellBackModifier',
            'rFlatHPModPerLevel',
            'rFlatArmorModPerLevel',
            'rFlatSpellBlockModPerLevel',
            'rFlatHPRegenModPerLevel',
            'rFlatPhysicalDamageModPerLevel',
            'rFlatMagicDamageModPerLevel',
            'rFlatMovementSpeedModPerLevel',
            'rPercentMovementSpeedModPerLevel',
            'rPercentAttackSpeedModPerLevel',
            'rFlatCritChanceModPerLevel',
            'rFlatCritDamageModPerLevel',
            'rFlatDodgeMod',
            'rFlatDodgeModPerLevel',
            'rFlatArmorPenetrationMod',
            'rFlatArmorPenetrationModPerLevel',
            'rPercentArmorPenetrationMod',
            'rPercentArmorPenetrationModPerLevel',
            'rPercentCooldownMod',
            'rPercentCooldownModPerLevel',
            'rFlatTimeDeadMod',
            'rFlatTimeDeadModPerLevel',
            'rPercentTimeDeadMod',
            'rPercentTimeDeadModPerLevel',
            'rFlatGoldPer10Mod',
            'rFlatMagicPenetrationMod',
            'rFlatMagicPenetrationModPerLevel',
            'rPercentMagicPenetrationMod',
            'rPercentMagicPenetrationModPerLevel',
            'PARStatName',
            'InventoryIcon',
            'Epicness',
            'Description',
            'DynamicTooltip',
            'EffectRadius'
        ],
        'Categories' => [
            'Health',
            'SpellBlock',
            'HealthRegen',
            'Armor',
            'Damage',
            'CriticalStrike',
            'AttackSpeed',
            'LifeSteal',
            'SpellDamage',
            'CooldownReduction',
            'Mana',
            'ManaRegen',
            'Movement',
            'Consumable',
            'Internal'
        ]
    ];

    protected static $numericInibinStructure;

    public function __construct() {
        if(self::$numericInibinStructure === null) {
            self::$numericInibinStructure = [];
            foreach(self::$inibinStructure as $group => $values) {
                foreach($values as $value) {
                    self::$numericInibinStructure[$this->getInibinNumericKey($group, $value)] = [$group, $value];
                }
            }
        }
    }

    public function getInibinNumericKey($sectionName = null, $varName = null) {
        $hashValue = 0;
        if($sectionName != null) {
            foreach(str_split($sectionName) as $char) $hashValue = (int) (ord(strtolower($char)) + 65599 * $hashValue);

            $hashValue = (int) (65599 * $hashValue + 42);
            if($varName !== null) {
                foreach(str_split($varName) as $char) $hashValue = (int) (ord(strtolower($char)) + 65599 * $hashValue);
            }
        }

        return sprintf('%u', $hashValue);
    }

    public function matchesInibinFile($inibinFile) {
        $values = $inibinFile->getValues(false);

        return key_exists('1746694807', $values) && key_exists('1746694807', $values) && strtoupper(substr($values['1746694807'], 0, 5)) == 'SPELL';
    }

    public function mapInibinKey($key) {
        return key_exists($key, self::$numericInibinStructure) ? self::$numericInibinStructure[$key] : null;
    }
}
?>